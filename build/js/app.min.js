"use strict";function mobileNavScroll(){$(".navbar-collapse").css({maxHeight:$(window).height()-$(".navbar-header").height()+"px"})}function zoomToMuni(selectedMuni){var whereClause='"MUNI" = \''+selectedMuni+"'";L.esri.query({url:"https://gis.ccpa.net/arcgiswebadaptor/rest/services/ArcGIS_Online/RoadsMunicipalBoundaries/MapServer/0"}).where(whereClause).bounds(function(error,latLngBounds,response){error?(console.warn("An error with the query request has occured"),console.warn("Code: "+error.code+"; Message: "+error.message)):response.features<1?console.log("No features selected"):map.fitBounds(latLngBounds)}),$("#panelMuniZoom").collapse("hide")}function processLoadEvent(service){service.on("requestsuccess",function(e){service.options.isLoaded=!0}),service.on("requesterror",function(e){e.url==service.options.url&&(service.options.isLoaded=!1,console.warn("Layer failed to load: "+service.options.url),console.warn("Code: "+e.code+"; Message: "+e.message),$("#layerErrorModal").modal("show"))})}function setPopupMaxHeight(windowArea){return windowArea<315e3?150:500}function setPopupMaxWidth(windowWidth){return windowWidth<450?240:300}function returnDomainText(value){var landUse=null;switch(value){case 1:landUse="Residential";break;case 2:landUse="Commercial";break;case 3:landUse="Institutional";break;case 4:landUse="Industrial";break;case 5:landUse="Agriculture";break;case 6:landUse="Woodland";break;default:landUse="Other"}return landUse}function convertJSONDateToString(jsonDate){var shortDate=null;if(jsonDate){var matches=/-?\d+/.exec(jsonDate),dt=new Date(parseInt(matches[0])),month=dt.getMonth()+1,monthString=month>9?month:"0"+month,day=dt.getDate();shortDate=monthString+"-"+(day>9?day:"0"+day)+"-"+dt.getFullYear()}return shortDate}function testforFiedlValues(field){return null!==field&&""!==field?field:"N/A"}function returnNumberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}$(document).ready(function(){function attachSearch(){var parentName=$(".geocoder-control").parent().attr("id"),geocoder=$(".geocoder-control"),width=$(window).width();width<=767&&"geocodeMobile"!==parentName?(geocoder.detach(),$("#geocodeMobile").append(geocoder)):width>767&&"geocode"!==parentName&&(geocoder.detach(),$("#geocode").append(geocoder))}$("#selectMuni").on("change",function(e){zoomToMuni($(this).val())}),mobileNavScroll(),function(){var width=$(window).width(),elements=[$("#panelFilter"),$("#collapseFilter")];if(width<=767)for(var i=0;i<elements.length;i++)elements[i].attr("aria-expanded","false"),elements[i].hasClass("in")&&elements[i].removeClass("in")}(),attachSearch();var input=$(".geocoder-control-input");input.focus(function(){$("#panelSearch .panel-body").css("height","150px")}),input.blur(function(){$("#panelSearch .panel-body").css("height","auto")}),$(window).resize(function(){mobileNavScroll(),attachSearch()})}),$(function(){function getDate(element){var date;try{date=$.datepicker.parseDate(dateFormat,element.value)}catch(error){date=null,$("#dateErrorModal").modal("show")}return date}var dateFormat="mm/dd/yy",from=$("#fromDate").datepicker({defaultDate:"0",changeMonth:!0,numberOfMonths:1}).on("change",function(){to.datepicker("option","minDate",getDate(this))}),to=$("#toDate").datepicker({defaultDate:"0",changeMonth:!0,numberOfMonths:1}).on("change",function(){from.datepicker("option","maxDate",getDate(this))})});const windowWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,windowArea=windowWidth*windowHeight,homeCoords=[40.15,-77.25],spcPACrs=new L.Proj.CRS("EPSG:2272","+proj=lcc +lat_1=40.96666666666667 +lat_2=39.93333333333333 +lat_0=39.33333333333334 +lon_0=-77.75 +x_0=600000 +y_0=0 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs",{origin:[-119214200,146166900],resolutions:[260.41666666666663,86.80555555555556,43.40277777777778,20.833333333333332,10.416666666666666,6.944444444444444,4.166666666666666,2.083333333333333,1.0416666666666665,.5208333333333333]}),map=L.map("map",{center:homeCoords,zoom:0,zoomControl:!1,crs:spcPACrs,minZoom:0,maxZoom:8}),zoomHomeControl=L.Control.zoomHome({position:"topleft",zoomHomeTitle:"Full map extent",homeCoordinates:homeCoords,homeZoom:0}).addTo(map),imagery2018=L.esri.tiledMapLayer({url:"https://gis.ccpa.net/arcgiswebadaptor/rest/services/Imagery2018/MapServer",maxZoom:8,minZoom:0,continuousWorld:!0,attribution:"Cumberland County",errorTileUrl:"//downloads2.esri.com/support/TechArticles/blank256.png",isLoaded:!1}),roadsMunicipality=L.esri.tiledMapLayer({url:"https://gis.ccpa.net/arcgiswebadaptor/rest/services/ArcGIS_Online/RoadsMunicipalBoundaries/MapServer",maxZoom:8,minZoom:0,continuousWorld:!0,attribution:"Cumberland County",errorTileUrl:"//downloads2.esri.com/support/TechArticles/blank256.png",isLoaded:!1}),planSubmissions=L.esri.featureLayer({url:"https://gis.ccpa.net/arcgiswebadaptor/rest/services/Planning/PlanSubmissionsReview/MapServer/0",onEachFeature:function(feature,layer){windowArea<315e3&&(layer.on("popupopen",function(){$("div.leaflet-top").css("opacity",0),$("div.leaflet-bottom").css("opacity",0)}),layer.on("popupclose",function(){$("div.leaflet-top").css("opacity",1),$("div.leaflet-bottom").css("opacity",1)}))},isLoaded:!1});planSubmissions.bindPopup(function(evt,layer){var formattedDate=convertJSONDateToString(evt.feature.properties.DATE),formattedLandUse=returnDomainText(evt.feature.properties.LANDUSE),sqFtField=evt.feature.properties.SQFT,sqFtVal=testforFiedlValues(sqFtField);"N/A"!==sqFtVal&&(sqFtVal=returnNumberWithCommas(sqFtField));var popupContent='<div class="feat-popup">';return popupContent+='<h3><span class="gray-text">Plan Name:</span> {NAME}</h3>',popupContent+="<ul>",popupContent+='<li><span class="gray-text">Land Use:</span> '+formattedLandUse+"</li>",popupContent+='<li><span class="gray-text">Date Received:</span> '+formattedDate+"</li>",popupContent+='<li><span class="gray-text">Square Footage:</span> '+sqFtVal+"</li>",popupContent+='<li><span class="gray-text">Number of Proposed Units:</span> '+testforFiedlValues(evt.feature.properties.UNITS)+"</li>",popupContent+="</ul>",popupContent+="<h4><strong>Description:</strong></h4>",popupContent+="<p>{DESCRIPTION}</p>",popupContent+="</div>",L.Util.template(popupContent,evt.feature.properties)},{closeOnClick:!0,maxHeight:setPopupMaxHeight(windowArea),maxWidth:setPopupMaxWidth(windowWidth)});const mapServices=[imagery2018,roadsMunicipality,planSubmissions];for(var i=0;i<mapServices.length;i++)processLoadEvent(mapServices[i]);for(i=0;i<mapServices.length;i++)mapServices[i].addTo(map);function clearFilter(){planSubmissions.setWhere(""),$("#panelFilter").collapse("hide")}function setFilter(){var where_clause='"DATE" >= date \''+$("#fromDate").val()+"' AND \"DATE\" <= date '"+$("#toDate").val()+"'";planSubmissions.setWhere(where_clause),$("#panelFilter").collapse("hide")}$("#setFilter").click(setFilter),$("#clearFilter").click(clearFilter);const ccpaProvider=L.esri.Geocoding.geocodeServiceProvider({label:"Street Addresses",maxResults:8,attribution:"Cumberland County",url:"//gis.ccpa.net/arcgiswebadaptor/rest/services/Composite_Address_Locator/GeocodeServer"}),featureLayerProvider=L.esri.Geocoding.featureLayerProvider({url:"https://gis.ccpa.net/arcgiswebadaptor/rest/services/Planning/PlanSubmissionsReview/MapServer/0",label:"Submitted Plans",maxResults:8,searchFields:["NAME"],formatSuggestion:function(feature){return feature.properties.NAME}}),addressSearchControl=L.esri.Geocoding.geosearch({useMapBounds:!1,providers:[featureLayerProvider,ccpaProvider],placeholder:"Search by Plan Name or Street Address",title:"Search Tool",expanded:!0,collapseAfterResult:!1,zoomToResult:!1}).addTo(map);function locateControl(){L.control.locate({position:"topleft",drawCircle:!0,follow:!1,setView:!0,keepCurrentZoomLevel:!1,markerStyle:{weight:1,opacity:.8,fillOpacity:.8},circleStyle:{weight:1,clickable:!1},icon:"fa fa-location-arrow",iconLoading:"fa fa-spinner fa-spin",metric:!1,onLocationError:function(err){alert(err.message)},onLocationOutsideMapBounds:function(context){alert(context.options.strings.outsideMapBoundsMsg)},strings:{title:"Find my location",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem to be located outside the boundaries of the map"},locateOptions:{maxZoom:18,watch:!0,enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}}).addTo(map)}addressSearchControl.on("results",function(data){if(data.results.length>0){map.setView(data.results[0].latlng,7);L.popup({closeOnClick:!0}).setLatLng(data.results[0].latlng).setContent(data.results[0].text).openOn(map)}else L.popup({closeOnClick:!0}).setLatLng(map.getCenter()).setContent("No results were found. Please try a different address.").openOn(map);$("#panelSearch").collapse("hide")});const loadScreenTimer=window.setInterval(function(){let backCover=$("#back-cover"),imagery2018Loaded=imagery2018.options.isLoaded,roadsMuniLoaded=roadsMunicipality.options.isLoaded,planReviewLoaded=planSubmissions.options.isLoaded;imagery2018Loaded&&roadsMuniLoaded&&planReviewLoaded?(window.setTimeout(function(){backCover.fadeOut("slow")},4e3),window.clearInterval(loadScreenTimer)):console.log("layers still loading")},2e3);$("#layerErrorModal").on("hide.bs.modal",function(e){$("#back-cover").fadeOut("slow"),window.clearInterval(loadScreenTimer)});
//# sourceMappingURL=app.map